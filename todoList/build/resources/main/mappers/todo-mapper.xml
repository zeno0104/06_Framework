<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.todo.model.mapper.TodoMapper">
	<!-- namespace : 연결할 DAO(== Mapper 인터페이스)의 경로를 작성(필수로 작성이 되어야하는 구문) => 없으면 
		서버가 안켜짐 => 패키지 경로를 포함한 전체 이름으로 작성해야함 -->

	<!-- 아래 태그는 mapper.xml 파일 생성하자마자 삭제! -->
	<!-- <cache-ref namespace=""/> -->

	<!-- DB와 관련된 코드를 모아두는 곳 -->
	<!-- namespace도 등록이 되어야 한다. -->
	<!-- 클라이언트에게 요청이 오면 컨트롤러 파일인데, client -> controller -> service -> dao -> 
		db 그리고 역으로 오는데, mybatis를 사용하면 dao단이 바뀌게 됌 Mapper 인터페이스를 사용하게 됌 해당 인터페이스 경로를 
		namespace에 작성해줌 -->

	<!-- 태그로 SQL 구문 지정하고 작성 -->
	<!-- 여기서부터는 Mybatis -->
	<!-- id는 todoMapper에 있는 메서드 명과 똑같이 해줘야 한다. -->

	<select id="testTitle" resultType="string">
		SELECT TODO_TITLE
		FROM TB_TODO
		WHERE TODO_NO = 1
	</select>
	<!-- <select> 태그 속성 - id 속성 : 태그를 식별하는 값 (연결된 Mapper의 메서드명과 동일하게 작성하면 된다) -->
	<!-- resultType=""은 반환받아오는 타입을 지정해주는 것 -> 반환 타입은 모두 소문자로 적기 -->
	<!-- resultType 속성 : 조회 결과 한 줄(1행)을 저장하여 반환할 변수/객체 자료형을 지정 -->
	<!-- 조회 결과가 여러행이면 행 별로 변수/객체 자료형으로 저장 후 모아서 List로 반환 -->
	<select id="selectAll" resultType="Todo">
		<!-- // DBConfig에서 세팅2. 별칭을 지정해야하는 DTO가 모여있는 패키지 지정 // -> 해당 패키지에 있는 모든 
			클래스가 클래스명으로 별칭이 지정됨 sessionFactoryBean.setTypeAliasesPackage("edu.kh.todo"); 
			따라서, 풀네임으로 적어야 하는데, 별칭으로만 사용할 수 있도록 설정하여 Todo라고 불러도 인식이 되는 것 -->
		SELECT TODO_NO, TODO_TITLE, COMPLETE,
		TO_CHAR(REG_DATE, 'YYYY-MM-DD
		HH24:MI:SS') REG_DATE
		FROM TB_TODO
		ORDER BY TODO_NO
	</select>
	<select id="getCompleteCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		TB_TODO
		WHERE COMPLETE = 'Y'
	</select>
	<!-- 할 일 추가 -->
	<!-- DML인 경우 resultType이 int형이기 때문에 resultType 무조건 생략 -->
	<!-- 따라서, resultType을 쓰면 안된다는 의미 -->
	<insert id="addTodo" parameterType="Todo">
		INSERT INTO TB_TODO
		VALUES(SEQ_TODO_NO.NEXTVAL, #{todoTitle}, #{todoContent}, DEFAULT,
		DEFAULT)
	</insert>
	<!-- parameterType : 전달받은 값(전달 인자)의 타입을 명시하는 속성 -> DTO, Map인 경우 필드명/key 
		를 입력해서 값/value을 하나씩 꺼내 사용할 수 있음 -->
		
		<!--
  	mapper.xml 에서 java data(파라미터)를 SQL에 삽입하는 방법!
  	
  	1) #{변수명 | 필드명} : SQL에 삽입 시 양쪽에 '' 붙여서 삽입
 
   ex) MEMBER_EMAIL = #{memberEmail}
   						-> 'member01@naver.com'
   				
   =============================================================
  
   2) ${변수명 | 필드명} : SQL에 삽입 시 양쪽에 '' 붙이지 않고 삽입				
  
   ${} 언제 사용할까?
   1) 삽입할 값이 숫자인 경우 -> 1 = '1'이 같기 때문에, #{}도 가능
   2) SQL문 자체가 변해야 하는 경우
  
   ex) SELECT MEMBER_NAME, ${key} FROM "MEMBER"
   -> ${key}가 ENROLL_DATE 인 경우
   -> SELECT MEMBER_NAME, ENROLL_DATE FROM "MEMBER"
  
   -> ${key}가 MEMBER_ADDRESS 인 경우
   -> SELECT MEMBER_NAME, MEMBER_ADDRESS FROM "MEMBER"
   				
 
   -->
		
</mapper>
